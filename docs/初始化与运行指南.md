# 数学课代表：初始化与运行指南

> 毕业设计题目：《基于Python的B站高等数学教学资源分析与推荐系统》  
> 应用名称：数学课代表

## 1. 环境准备

1) 创建并激活虚拟环境（Windows）：
```bash
python -m venv .venv
.\.venv\Scripts\activate
```

2) 安装依赖：
```bash
pip install -r requirements.txt
```

## 2. 数据库初始化（两种方式）

### 方式 A（推荐）：导入转存 SQL（适合新库/新环境）

仓库内提供：`docs/migrations/bilibili_math_db.sql`（包含建表 + 示例数据）。

用 Navicat 操作：
1) 新建一个空数据库（例如：`bilibili_math_db` 或 `bilibili_math_db_new`）
2) 右键该数据库 → 运行 SQL 文件 / 执行 SQL 文件
3) 选择 `docs/migrations/bilibili_math_db.sql` 导入

导入完成后，在 `config.py` 中把 `SQLALCHEMY_DATABASE_URI` 指向你导入的库名即可。

### 方式 B：保留旧库（不重建）

如果你的数据库里已经有 `videos` 等表，且不想导入整库 SQL：
1) 建议先备份数据库
2) 运行爬虫时打开 `auto_migrate=true`，由爬虫自动检查并补齐缺失字段（适合“只补列”）

## 3. 配置（本项目暂不使用环境变量）

编辑 `config.py`：
- `SQLALCHEMY_DATABASE_URI`：改成你的 MySQL 连接串
- `BILI_COOKIE`：需要更稳定的采集时再填（只填本地，不要提交）

## 4. 启动 Web 应用

```bash
flask --app app run --debug
```

访问：`http://127.0.0.1:5000/`  
首次使用请先注册账号再登录。

## 5. 手动更新爬虫数据（两种方式）

### 方式 A：网页操作

登录后进入“更新数据”页面（`/spider`）创建采集任务。

### 方式 B：命令行执行

```bash
python spider/bilibili_api.py
```

## 6. 训练分类模型（建议流程）

目标：用“人工标注 + 可复训”提高分类稳定性（方便写论文实验部分）。

1) 导出待标注样本：
```bash
python train_model.py --export-labels labels_to_fix.csv
```

2) 用 Excel 打开 `labels_to_fix.csv`，人工填写/修正 `subject_label` 列（保留 `bvid` 不变）。

3) 使用人工标注训练并输出模型文件：
```bash
python train_model.py --labels-csv labels_to_fix.csv --output subject_classifier.pkl
```

训练完成后，把 `subject_classifier.pkl` 放在项目根目录；爬虫会自动加载它用于分类。

## 7. 如何测试

运行单元测试：
```bash
pytest -q
```

建议你在答辩前做一次全链路自测：
- 登录/注册
- 资源检索（一级/二级分类切换）
- UP 对比
- 推荐页（换一换、收藏/待办）
- 更新数据页（创建任务、查看日志）

